{% extends 'base.html' %}
{% load cloudflare_images %}

{% block title %}Unique Travel Experiences - Hidden Gems & Local Adventures | HygGeo{% endblock %}

{% block description %}Discover hidden gems and unique travel experiences in destinations worldwide. Find secret local spots, authentic adventures, offbeat activities, weekend getaways, and unforgettable experiences off the beaten path.{% endblock %}

{% block keywords %}hidden gems, travel hidden gems, local hidden gems, secret spots, unique experiences, travel experiences, things to do, offbeat travel, authentic adventures, weekend trips, adventure travel, travel ideas, bucket list experiences, undiscovered destinations{% endblock %}

{% block extra_head %}
<!-- Preload first experience card image if available -->
{% if experiences.0.main_image %}
<link rel="preload" as="image" href="{{ experiences.0.main_image.url|cf_image:'format=webp,width=400,quality=30,fit=cover' }}" fetchpriority="high">
{% endif %}
{% endblock %}

<!-- Structured Data for Experience List -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "ItemList",
  "name": "Hidden Gems & Unique Travel Experiences",
  "description": "Curated collection of hidden gems, secret spots, and unique local experiences for travelers seeking authentic adventures off the beaten path",
  "url": "{{ request.build_absolute_uri }}",
  "numberOfItems": {{ total_count|default:0 }},
  "itemListElement": [
    {% for experience in experiences %}
    {
      "@type": "ListItem",
      "position": {{ forloop.counter }},
      "item": {
        "@type": "TouristAttraction",
        "name": "{{ experience.title }}",
        "description": "{{ experience.short_description|default:experience.description|striptags|truncatewords:30 }}",
        "url": "{{ request.scheme }}://{{ request.get_host }}{% url 'experiences:experience_detail' experience.slug %}",
        {% if experience.main_image %}"image": "{{ request.scheme }}://{{ request.get_host }}{{ experience.main_image.url }}",{% endif %}
        "address": {
          "@type": "PostalAddress",
          "addressLocality": "{{ experience.destination.name }}",
          "addressCountry": "{{ experience.destination.country }}"
        },
        "offers": {
          "@type": "Offer",
          "priceCurrency": "{{ experience.currency }}",
          {% if experience.price_from %}"price": "{{ experience.price_from }}",{% endif %}
          "availability": "https://schema.org/InStock"
        }
      }
    }{% if not forloop.last %},{% endif %}
    {% endfor %}
  ]
}
</script>

{% block content %}
<!-- Modern Hero Header -->
<div class="experiences-hero">
    <div class="container">
        <div class="hero-content">
            <h1 class="hero-title">
                <i class="fas fa-compass me-3"></i>Hidden Gems & Unique Experiences
            </h1>
            <p class="hero-subtitle">Discover secret spots and authentic adventures off the beaten path</p>
        </div>
    </div>
</div>

<div class="container py-4">
    <!-- Modern Search & Filter Bar -->
    <div class="search-filter-section">
        <form method="get" id="filterForm">
            <!-- Main Search Bar -->
            <div class="main-search-bar">
                <div class="search-input-wrapper">
                    <i class="fas fa-search"></i>
                    <input type="text" name="search" value="{{ current_filters.search|default:'' }}"
                           placeholder="Search experiences, destinations, activities..." class="search-input">
                    <button type="submit" class="search-submit-button">
                        <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
                <div class="primary-filters">
                    <select class="modern-select" name="destination" id="destination">
                        <option value="">All Destinations</option>
                        {% for destination in destinations %}
                        <option value="{{ destination.slug }}" {% if current_filters.destination == destination.slug %}selected{% endif %}>
                            {{ destination.name }}
                        </option>
                        {% endfor %}
                    </select>

                    <select class="modern-select" name="category" id="category">
                        <option value="">All Categories</option>
                        {% for category in categories %}
                        <option value="{{ category.slug }}" {% if current_filters.category == category.slug %}selected{% endif %}>
                            {{ category.name }}
                        </option>
                        {% endfor %}
                    </select>

                    <button type="button" class="more-filters-btn" id="toggleMoreFilters">
                        <i class="fas fa-sliders-h me-2"></i>More Filters
                        <i class="fas fa-chevron-down ms-2"></i>
                    </button>
                </div>
            </div>

            <!-- Advanced Filters (Collapsible) -->
            <div class="advanced-filters" id="advancedFilters">
                <div class="filters-grid">
                    <div class="filter-group">
                        <label><i class="fas fa-hiking me-2"></i>Type</label>
                        <select class="modern-select" name="type">
                            <option value="">All Types</option>
                            {% for exp_type in experience_types %}
                            <option value="{{ exp_type.slug }}" {% if current_filters.type == exp_type.slug %}selected{% endif %}>
                                {{ exp_type.name }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="filter-group">
                        <label><i class="fas fa-dollar-sign me-2"></i>Budget</label>
                        <select class="modern-select" name="budget">
                            <option value="">All Budgets</option>
                            {% for value, label in budget_ranges %}
                            <option value="{{ value }}" {% if current_filters.budget == value %}selected{% endif %}>
                                {{ label }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="filter-group">
                        <label><i class="fas fa-clock me-2"></i>Duration</label>
                        <select class="modern-select" name="duration">
                            <option value="">Any Duration</option>
                            {% for value, label in duration_types %}
                            <option value="{{ value }}" {% if current_filters.duration == value %}selected{% endif %}>
                                {{ label }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="filter-group">
                        <label><i class="fas fa-users me-2"></i>Group Size</label>
                        <select class="modern-select" name="group_size">
                            <option value="">Any Size</option>
                            {% for value, label in group_sizes %}
                            <option value="{{ value }}" {% if current_filters.group_size == value %}selected{% endif %}>
                                {{ label }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="filter-group">
                        <label><i class="fas fa-leaf me-2"></i>Sustainability</label>
                        <select class="modern-select" name="sustainability_min">
                            <option value="">Any Score</option>
                            <option value="6" {% if current_filters.sustainability_min == "6" %}selected{% endif %}>Good (6+)</option>
                            <option value="8" {% if current_filters.sustainability_min == "8" %}selected{% endif %}>Excellent (8+)</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label><i class="fas fa-heart me-2"></i>Hygge Factor</label>
                        <select class="modern-select" name="hygge_min">
                            <option value="">Any Score</option>
                            <option value="6" {% if current_filters.hygge_min == "6" %}selected{% endif %}>Good (6+)</option>
                            <option value="8" {% if current_filters.hygge_min == "8" %}selected{% endif %}>Excellent (8+)</option>
                        </select>
                    </div>
                </div>

                <div class="filter-actions">
                    <label class="eco-checkbox">
                        <input type="checkbox" name="carbon_neutral" value="true"
                               {% if current_filters.carbon_neutral == "true" %}checked{% endif %}>
                        <span><i class="fas fa-seedling me-2"></i>Carbon Neutral Only</span>
                    </label>
                    <div class="action-buttons">
                        <a href="{% url 'experiences:experience_list' %}" class="clear-btn">
                            <i class="fas fa-times me-2"></i>Clear All
                        </a>
                        <button type="submit" class="apply-btn">
                            <i class="fas fa-search me-2"></i>Search
                        </button>
                    </div>
                </div>
            </div>
        </form>
    </div>

    <!-- Results Bar with Sorting and Active Filters -->
    <div class="results-bar">
        <div class="results-info">
            <span class="results-count">{{ total_count }} experience{{ total_count|pluralize }}</span>
            {% if current_filters.search or current_filters.category or current_filters.destination or current_filters.type or current_filters.budget or current_filters.group_size or current_filters.duration or current_filters.sustainability_min or current_filters.hygge_min or current_filters.carbon_neutral %}
            <div class="active-filters">
                {% if current_filters.search %}
                    <span class="filter-chip">"{{ current_filters.search }}"<i class="fas fa-times ms-2"></i></span>
                {% endif %}
            </div>
            {% endif %}
        </div>

        <div class="results-actions">
            <form method="get" class="sort-form">
                <!-- Preserve all current filters -->
                {% for key, value in request.GET.items %}
                    {% if key != 'sort' %}
                    <input type="hidden" name="{{ key }}" value="{{ value }}">
                    {% endif %}
                {% endfor %}

                <div class="sort-select-wrapper">
                    <i class="fas fa-sort-amount-down"></i>
                    <select name="sort" class="sort-select" onchange="this.form.submit()">
                        <option value="newest" {% if current_filters.sort == "newest" or not current_filters.sort %}selected{% endif %}>Newest First</option>
                        <option value="sustainability" {% if current_filters.sort == "sustainability" %}selected{% endif %}>Most Sustainable</option>
                        <option value="hygge" {% if current_filters.sort == "hygge" %}selected{% endif %}>Most Hygge</option>
                        <option value="price_low" {% if current_filters.sort == "price_low" %}selected{% endif %}>Price: Low to High</option>
                        <option value="price_high" {% if current_filters.sort == "price_high" %}selected{% endif %}>Price: High to Low</option>
                        <option value="alphabetical" {% if current_filters.sort == "alphabetical" %}selected{% endif %}>A-Z</option>
                    </select>
                </div>
            </form>

            <div class="quick-actions">
                <a href="{% url 'experiences:recommendations' %}" class="quick-action-btn">
                    <i class="fas fa-compass"></i>
                    <span>Recommendations</span>
                </a>
                <a href="{% url 'experiences:my_bookmarks' %}" class="quick-action-btn">
                    <i class="fas fa-bookmark"></i>
                    <span>Bookmarks</span>
                </a>
            </div>
        </div>
    </div>

    <!-- Experience Grid -->
    <div class="row g-4 mb-5" id="experiencesGrid">
        {% include 'experiences/experience_cards.html' with experiences=experiences user_bookmarks=user_bookmarks %}

        {% if not experiences %}
        <div class="col-12">
            <div class="text-center py-5">
                <i class="fas fa-search text-muted" style="font-size: 4rem;"></i>
                <h4 class="text-muted mt-3">No experiences found</h4>
                <p class="text-muted">Try adjusting your filters or search terms</p>
                <a href="{% url 'experiences:experience_list' %}" class="btn btn-hygge">
                    <i class="fas fa-refresh me-2"></i>View All Experiences
                </a>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Load More Button -->
    {% if has_more %}
    <div class="row mb-5">
        <div class="col-12 text-center">
            <button id="loadMoreBtn" class="btn btn-hygge btn-lg" data-offset="{{ initial_offset }}">
                <i class="fas fa-plus-circle me-2"></i>Load More Experiences
            </button>
            <div id="loadingSpinner" class="d-none mt-3">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="text-muted mt-2">Loading more experiences...</p>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<style>
.bookmark-btn {
    width: 40px;
    padding: 0.375rem 0;
}

.bookmark-btn.bookmarked {
    background-color: var(--hygge-gold);
    border-color: var(--hygge-gold);
    color: white;
}

.bookmark-btn.bookmarked:hover {
    background-color: #d19900;
    border-color: #d19900;
    color: white;
}

.bookmark-btn.bookmarked i {
    color: white;
}

.btn-outline-hygge-edit {
    border: 1px solid var(--hygge-gold);
    color: var(--hygge-gold);
    background: transparent;
}

.btn-outline-hygge-edit:hover {
    background: var(--hygge-gold);
    color: white;
    border-color: var(--hygge-gold);
}

.card-hygge {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.card-hygge:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(0,0,0,0.15);
}

.page-link {
    color: var(--hygge-green);
    border-color: #dee2e6;
}

.page-item.active .page-link {
    background-color: var(--hygge-green);
    border-color: var(--hygge-green);
}

.page-link:hover {
    color: var(--hygge-light-green);
    background-color: rgba(74, 124, 89, 0.1);
    border-color: var(--hygge-light-green);
}

/* Modern Experiences Page Styles */
.experiences-hero {
    background: linear-gradient(135deg, #2d5a3d 0%, #4a7c59 100%);
    padding: 3rem 0;
    margin-bottom: 2rem;
}

.hero-content {
    text-align: center;
}

.hero-title {
    color: white;
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 0.75rem;
    text-shadow: 0 2px 4px rgba(0,0,0,0.3), 0 4px 12px rgba(0,0,0,0.4);
}

.hero-subtitle {
    color: rgba(255, 255, 255, 0.95);
    font-size: 1.2rem;
    margin: 0;
    text-shadow: 0 1px 3px rgba(0,0,0,0.3);
}

.search-filter-section {
    background: white;
    border-radius: 16px;
    padding: 1.5rem;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    margin-bottom: 2rem;
}

.main-search-bar {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
    align-items: stretch;
}

.search-input-wrapper {
    flex: 1;
    min-width: 250px;
    position: relative;
    display: flex;
    align-items: center;
    background: white;
    border: 2px solid #e0e0e0;
    border-radius: 12px;
    transition: all 0.3s ease;
}

.search-input-wrapper:focus-within {
    border-color: #2d5a3d;
    box-shadow: 0 0 0 3px rgba(45, 90, 61, 0.1);
}

.search-input-wrapper > i {
    position: absolute;
    left: 1.25rem;
    color: #999;
    font-size: 1.1rem;
    z-index: 1;
}

.search-input {
    flex: 1;
    padding: 0.875rem 1.25rem 0.875rem 3.25rem;
    border: none;
    background: transparent;
    font-size: 1rem;
    outline: none;
    box-sizing: border-box;
    width: 100%;
}

.search-submit-button {
    background: linear-gradient(135deg, #2d5a3d 0%, #4a7c59 100%);
    color: white;
    border: none;
    padding: 0.875rem 1.5rem;
    border-radius: 0 10px 10px 0;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 60px;
    box-sizing: border-box;
    flex-shrink: 0;
}

.search-submit-button:hover {
    transform: translateX(2px);
    background: linear-gradient(135deg, #1e4a2f 0%, #3a6b49 100%);
}

.search-submit-button i {
    font-size: 1.1rem;
}

.primary-filters {
    display: flex;
    gap: 0.75rem;
    flex-wrap: wrap;
}

.modern-select {
    padding: 0.875rem 1.25rem;
    border: 2px solid #e0e0e0;
    border-radius: 12px;
    font-size: 0.95rem;
    font-weight: 500;
    background: white;
    cursor: pointer;
    transition: all 0.3s ease;
    min-width: 160px;
}

.modern-select:hover {
    border-color: #2d5a3d;
}

.modern-select:focus {
    outline: none;
    border-color: #2d5a3d;
    box-shadow: 0 0 0 3px rgba(45, 90, 61, 0.1);
}

.more-filters-btn {
    display: flex;
    align-items: center;
    padding: 0.875rem 1.5rem;
    background: linear-gradient(135deg, #2d5a3d 0%, #4a7c59 100%);
    color: white;
    border: none;
    border-radius: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    white-space: nowrap;
}

.more-filters-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(45, 90, 61, 0.3);
}

.more-filters-btn i.fa-chevron-down {
    transition: transform 0.3s ease;
}

.more-filters-btn.active i.fa-chevron-down {
    transform: rotate(180deg);
}

.advanced-filters {
    max-height: 0;
    overflow: hidden;
    opacity: 0;
    transition: all 0.4s ease;
}

.advanced-filters.show {
    max-height: 600px;
    opacity: 1;
    margin-top: 1.5rem;
}

.filters-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 1.25rem;
    margin-bottom: 1.5rem;
}

.filter-group label {
    display: block;
    font-weight: 600;
    color: #333;
    margin-bottom: 0.5rem;
    font-size: 0.9rem;
}

.filter-group label i {
    color: #2d5a3d;
}

.filter-actions {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 1.5rem;
    border-top: 2px solid #f0f0f0;
    flex-wrap: wrap;
    gap: 1rem;
}

.eco-checkbox {
    display: flex;
    align-items: center;
    cursor: pointer;
    font-weight: 600;
    color: #333;
}

.eco-checkbox input {
    margin-right: 0.5rem;
    width: 20px;
    height: 20px;
    cursor: pointer;
}

.action-buttons {
    display: flex;
    gap: 0.75rem;
}

.clear-btn {
    padding: 0.75rem 1.5rem;
    background: white;
    color: #666;
    border: 2px solid #e0e0e0;
    border-radius: 10px;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
}

.clear-btn:hover {
    border-color: #dc3545;
    color: #dc3545;
}

.apply-btn {
    padding: 0.75rem 2rem;
    background: linear-gradient(135deg, #2d5a3d 0%, #4a7c59 100%);
    color: white;
    border: none;
    border-radius: 10px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
}

.apply-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(45, 90, 61, 0.3);
}

.results-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
    flex-wrap: wrap;
    gap: 1.5rem;
}

.results-info {
    display: flex;
    align-items: center;
    gap: 1rem;
    flex-wrap: wrap;
}

.results-count {
    font-size: 1.1rem;
    font-weight: 700;
    color: #333;
}

.results-actions {
    display: flex;
    align-items: center;
    gap: 1rem;
    flex-wrap: wrap;
}

.sort-form {
    margin: 0;
}

.sort-select-wrapper {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.6rem 1rem;
    background: white;
    border: 2px solid #e0e0e0;
    border-radius: 10px;
}

.sort-select-wrapper i {
    color: #2d5a3d;
}

.sort-select {
    border: none;
    outline: none;
    font-weight: 600;
    color: #333;
    cursor: pointer;
    background: transparent;
}

.quick-actions {
    display: flex;
    gap: 0.75rem;
}

.quick-action-btn {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.6rem 1.25rem;
    background: white;
    color: #2d5a3d;
    border: 2px solid #e0e0e0;
    border-radius: 10px;
    text-decoration: none;
    font-weight: 600;
    font-size: 0.9rem;
    transition: all 0.3s ease;
}

.quick-action-btn:hover {
    border-color: #2d5a3d;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

/* Touch-friendly improvements for all mobile */
@media (max-width: 992px) {
    /* Ensure minimum tap target size of 44x44px for touch devices */
    button,
    .btn,
    .page-link,
    select,
    input[type="checkbox"],
    input[type="radio"],
    a.quick-action-btn {
        min-height: 44px;
        min-width: 44px;
    }

    /* Increase spacing for easier touch interaction */
    .primary-filters {
        gap: 0.875rem;
    }

    .filters-grid {
        gap: 1.25rem;
    }

    /* Make checkboxes and radio buttons larger */
    input[type="checkbox"],
    input[type="radio"] {
        width: 24px;
        height: 24px;
    }
}

/* Tablet styles */
@media (max-width: 768px) {
    .experiences-hero {
        padding: 2.5rem 0;
    }

    .hero-title {
        font-size: 2.25rem;
    }

    .hero-subtitle {
        font-size: 1.15rem;
    }

    .search-filter-section {
        padding: 1.25rem;
    }

    .results-bar {
        gap: 1rem;
    }

    .action-buttons {
        flex-direction: column;
        gap: 0.75rem;
    }

    .clear-btn,
    .apply-btn {
        width: 100%;
        justify-content: center;
    }

    /* Tablet card improvements */
    .experience-card-item {
        padding-left: 0.75rem !important;
        padding-right: 0.75rem !important;
    }

    .card-hygge {
        border-radius: 14px;
    }

    .card-img-top {
        height: 200px !important;
    }

    .card-body h6 {
        font-size: 1.05rem;
    }

    .btn-hygge,
    .btn-outline-hygge {
        font-size: 0.925rem;
        padding: 0.7rem 1.1rem;
    }
}

@media (max-width: 992px) {
    .experiences-hero {
        padding: 2.5rem 0;
    }

    .hero-title {
        font-size: 2rem;
    }

    .hero-subtitle {
        font-size: 1.1rem;
    }

    .main-search-bar {
        flex-direction: column;
        width: 100%;
    }

    .search-input-wrapper {
        min-width: 100%;
        width: 100%;
        max-width: 100%;
        border-radius: 12px;
        box-sizing: border-box;
    }

    .search-input {
        padding: 1rem 0.5rem 1rem 3rem;
        font-size: 1rem;
    }

    .search-submit-button {
        padding: 1rem 1rem;
        min-width: 50px;
        border-radius: 0 10px 10px 0;
    }

    .primary-filters {
        width: 100%;
        flex-direction: column;
    }

    .modern-select,
    .more-filters-btn {
        width: 100%;
        flex: none;
        min-width: 100%;
        padding: 1rem 1.25rem;
        font-size: 1rem;
    }

    .filters-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
    }

    .results-bar {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
    }

    .results-info {
        width: 100%;
    }

    .results-actions {
        width: 100%;
        flex-direction: column;
        gap: 0.75rem;
    }

    .sort-form {
        width: 100%;
    }

    .sort-select-wrapper {
        width: 100%;
        padding: 0.875rem 1rem;
        justify-content: space-between;
    }

    .quick-actions {
        width: 100%;
        gap: 0.5rem;
    }

    .quick-action-btn {
        flex: 1;
        justify-content: center;
        padding: 0.875rem 0.75rem;
        font-size: 0.95rem;
    }
}

@media (max-width: 576px) {
    .container {
        padding-left: 1rem;
        padding-right: 1rem;
        max-width: 100%;
        overflow-x: hidden;
    }

    .experiences-hero {
        padding: 2rem 0;
    }

    .hero-content {
        padding: 0 1rem;
    }

    .search-filter-section {
        padding: 1rem;
        border-radius: 12px;
        margin-bottom: 1.5rem;
        box-sizing: border-box;
        max-width: 100%;
    }

    .hero-title {
        font-size: 1.75rem;
        line-height: 1.3;
    }

    .hero-title i {
        font-size: 1.5rem;
        margin-right: 0.5rem !important;
    }

    .hero-subtitle {
        font-size: 0.95rem;
        line-height: 1.4;
        padding: 0 0.5rem;
    }

    .search-input-wrapper {
        width: 100%;
        max-width: 100%;
        border-radius: 10px;
        box-sizing: border-box;
    }

    .search-input {
        padding: 0.875rem 0.5rem 0.875rem 2.75rem;
        font-size: 0.95rem;
    }

    .search-input-wrapper > i {
        left: 0.875rem;
        font-size: 1rem;
    }

    .search-submit-button {
        padding: 0.875rem 0.875rem;
        min-width: 48px;
        border-radius: 0 8px 8px 0;
    }

    .search-submit-button i {
        font-size: 1rem;
    }

    .primary-filters {
        flex-direction: column;
        gap: 0.75rem;
    }

    .modern-select,
    .more-filters-btn {
        width: 100%;
        padding: 0.875rem 1rem;
        font-size: 0.95rem;
        border-radius: 10px;
    }

    .more-filters-btn {
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .advanced-filters {
        padding: 1rem;
        border-radius: 10px;
    }

    .filter-group label {
        font-size: 0.9rem;
    }

    .range-value {
        font-size: 0.85rem;
    }

    .action-buttons {
        flex-direction: column;
        gap: 0.75rem;
    }

    .clear-btn,
    .apply-btn {
        width: 100%;
        justify-content: center;
        padding: 1rem 1.5rem;
        font-size: 1rem;
        font-weight: 600;
    }

    .clear-btn i,
    .apply-btn i {
        font-size: 1rem;
    }

    .results-count {
        font-size: 1rem;
    }

    .sort-select-wrapper {
        padding: 0.75rem 1rem;
    }

    .sort-select {
        font-size: 0.9rem;
    }

    .quick-action-btn {
        padding: 0.75rem 0.5rem;
        font-size: 0.875rem;
    }

    .quick-action-btn span {
        display: none;
    }

    .quick-action-btn i {
        margin: 0;
        font-size: 1.1rem;
    }

    /* Card improvements for mobile */
    .row.g-4 {
        gap: 1rem !important;
    }

    .experience-card-item {
        padding-left: 0.5rem !important;
        padding-right: 0.5rem !important;
    }

    .card-hygge {
        margin-bottom: 1rem;
        border-radius: 12px;
        overflow: hidden;
    }

    .card-img-top {
        height: 180px !important;
    }

    .card-body {
        padding: 1rem !important;
    }

    /* Card header - title and badges */
    .card-body h6 {
        font-size: 1rem;
        line-height: 1.3;
        margin-bottom: 0.5rem !important;
    }

    .card-body .badge {
        font-size: 0.7rem !important;
        padding: 0.25rem 0.5rem;
        white-space: nowrap;
    }

    /* Location and type badges */
    .card-body .text-muted.small {
        font-size: 0.875rem !important;
    }

    .card-body .badge.bg-secondary,
    .card-body .badge.bg-info {
        font-size: 0.7rem !important;
        padding: 0.25rem 0.5rem;
    }

    /* Description text */
    .card-body p.small {
        font-size: 0.875rem !important;
        line-height: 1.5;
        margin-bottom: 0.75rem !important;
    }

    /* Features - sustainability, hygge scores */
    .card-body .d-flex.small {
        font-size: 0.85rem !important;
        flex-wrap: wrap;
        gap: 0.5rem;
    }

    .card-body .d-flex.small > div {
        display: flex;
        align-items: center;
        white-space: nowrap;
    }

    /* Price and duration */
    .card-body .fw-bold.text-primary {
        font-size: 1.1rem !important;
    }

    .card-body small.text-muted {
        font-size: 0.8rem !important;
    }

    /* Action buttons */
    .btn-hygge,
    .btn-outline-hygge,
    .btn-outline-hygge-edit {
        font-size: 0.9rem !important;
        padding: 0.65rem 1rem !important;
        min-height: 44px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .btn-sm {
        min-height: 44px !important;
    }

    .btn-hygge i,
    .btn-outline-hygge i {
        font-size: 0.9rem;
    }

    .bookmark-btn {
        min-width: 44px !important;
        padding: 0.65rem 0.75rem !important;
    }

    /* Card action buttons container */
    .card-body .d-flex.gap-2 {
        gap: 0.5rem !important;
    }

    /* Pagination on mobile */
    .pagination {
        font-size: 0.875rem;
    }

    .page-link {
        padding: 0.5rem 0.75rem;
    }
}

/* Extra small phones */
@media (max-width: 380px) {
    .hero-title {
        font-size: 1.5rem;
    }

    .hero-title i {
        display: block;
        margin-bottom: 0.5rem;
        margin-right: 0 !important;
    }

    .hero-subtitle {
        font-size: 0.9rem;
    }

    .search-filter-section {
        padding: 0.875rem;
        box-sizing: border-box;
        max-width: 100%;
    }

    .search-input-wrapper {
        width: 100%;
        max-width: 100%;
        border-radius: 10px;
        box-sizing: border-box;
    }

    .search-input {
        font-size: 0.9rem;
        padding: 0.75rem 0.5rem 0.75rem 2.5rem;
    }

    .search-input-wrapper > i {
        left: 0.75rem;
        font-size: 0.9rem;
    }

    .search-submit-button {
        padding: 0.75rem 0.75rem;
        min-width: 44px;
        border-radius: 0 8px 8px 0;
    }

    .search-submit-button i {
        font-size: 0.9rem;
    }

    .modern-select,
    .more-filters-btn {
        padding: 0.75rem 0.875rem;
        font-size: 0.9rem;
    }

    .clear-btn,
    .apply-btn {
        padding: 0.875rem 1.25rem;
        font-size: 0.95rem;
    }

    .advanced-filters {
        padding: 0.875rem;
    }

    /* Extra small card improvements */
    .card-img-top {
        height: 160px !important;
    }

    .card-body {
        padding: 0.875rem !important;
    }

    .card-body h6 {
        font-size: 0.95rem !important;
        line-height: 1.25;
    }

    .card-body .badge {
        font-size: 0.65rem !important;
        padding: 0.2rem 0.4rem;
    }

    .card-body .text-muted.small {
        font-size: 0.8rem !important;
    }

    .card-body p.small {
        font-size: 0.8rem !important;
        margin-bottom: 0.65rem !important;
    }

    .card-body .d-flex.small {
        font-size: 0.8rem !important;
    }

    .card-body .fw-bold.text-primary {
        font-size: 1rem !important;
    }

    .btn-hygge,
    .btn-outline-hygge {
        font-size: 0.85rem !important;
        padding: 0.6rem 0.875rem !important;
    }

    .btn-hygge i {
        font-size: 0.85rem;
    }

    .bookmark-btn {
        min-width: 42px !important;
        padding: 0.6rem 0.65rem !important;
    }
}
</style>

<script>
// Toggle More Filters
document.addEventListener('DOMContentLoaded', function() {
    const toggleBtn = document.getElementById('toggleMoreFilters');
    const advancedFilters = document.getElementById('advancedFilters');

    if (toggleBtn && advancedFilters) {
        toggleBtn.addEventListener('click', function() {
            advancedFilters.classList.toggle('show');
            this.classList.toggle('active');
        });
    }

    // Auto-submit form when filters change
    const form = document.getElementById('filterForm');
    const filterElements = form.querySelectorAll('select:not(.sort-select), input[type="checkbox"]');
    const searchInput = form.querySelector('input[name="search"]');

    // Auto-submit for select elements and checkboxes
    filterElements.forEach(element => {
        element.addEventListener('change', function() {
            form.submit();
        });
    });

    // Search with debounce
    let searchTimeout;
    if (searchInput) {
        searchInput.addEventListener('input', function() {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                form.submit();
            }, 800);
        });
    }

    // Show loading state
    function showFilterLoading() {
        const submitBtn = form.querySelector('button[type="submit"]');
        if (submitBtn) {
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Filtering...';
            submitBtn.disabled = true;
        }

        // Add subtle loading indicator to form
        form.style.opacity = '0.8';
        form.style.pointerEvents = 'none';
    }

    // Reset filter loading state (in case of navigation back)
    function resetFilterLoading() {
        const submitBtn = form.querySelector('button[type="submit"]');
        if (submitBtn) {
            submitBtn.innerHTML = '<i class="fas fa-search me-2"></i>Search';
            submitBtn.disabled = false;
        }
        form.style.opacity = '1';
        form.style.pointerEvents = 'auto';
    }

    // Reset loading state when page loads
    resetFilterLoading();
    
    // Bookmark functionality
    const bookmarkButtons = document.querySelectorAll('.bookmark-btn');
    
    bookmarkButtons.forEach(button => {
        button.addEventListener('click', async function(e) {
            e.preventDefault();

            {% if not user.is_authenticated %}
            // Redirect to login if not authenticated
            window.location.href = '{% url "login" %}';
            return;
            {% endif %}

            const experienceId = this.dataset.experienceId;
            const icon = this.querySelector('i');
            const originalContent = this.innerHTML;

            // Show loading state
            this.disabled = true;
            this.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';

            try {
                const response = await fetch(`{% url 'experiences:bookmark_experience' '00000000-0000-0000-0000-000000000000' %}`.replace('00000000-0000-0000-0000-000000000000', experienceId), {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                        'Content-Type': 'application/json',
                    },
                });

                const data = await response.json();

                if (data.success) {
                    if (data.bookmarked) {
                        this.innerHTML = '<i class="fas fa-bookmark"></i>';
                        this.classList.add('bookmarked');
                        showBookmarkMessage('Added to bookmarks!', 'success');
                    } else {
                        this.innerHTML = '<i class="far fa-bookmark"></i>';
                        this.classList.remove('bookmarked');
                        showBookmarkMessage('Removed from bookmarks', 'info');
                    }
                } else {
                    console.error('Bookmark failed:', data.error);
                    showBookmarkMessage('Failed to bookmark', 'error');
                    this.innerHTML = originalContent;
                }
            } catch (error) {
                console.error('Error bookmarking experience:', error);
                showBookmarkMessage('Network error', 'error');
                this.innerHTML = originalContent;
            }

            this.disabled = false;
        });
    });

    // Show bookmark feedback messages
    function showBookmarkMessage(message, type) {
        const messageDiv = document.createElement('div');
        messageDiv.className = `alert alert-${type === 'success' ? 'success' : type === 'error' ? 'danger' : 'info'} position-fixed`;
        messageDiv.style.cssText = 'top: 20px; right: 20px; z-index: 1050; min-width: 250px;';
        messageDiv.innerHTML = `
            <div class="d-flex align-items-center">
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-triangle' : 'info-circle'} me-2"></i>
                ${message}
            </div>
        `;

        document.body.appendChild(messageDiv);

        // Auto-remove after 3 seconds
        setTimeout(() => {
            messageDiv.remove();
        }, 3000);
    }
    
    // Add animation to cards
    function animateCards() {
        const cards = document.querySelectorAll('.experience-card-item');
        cards.forEach((card, index) => {
            if (!card.classList.contains('animated')) {
                card.style.opacity = '0';
                card.style.transform = 'translateY(30px)';

                setTimeout(() => {
                    card.style.transition = 'all 0.6s ease';
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                    card.classList.add('animated');
                }, index * 50);
            }
        });
    }

    // Animate initial cards
    animateCards();

    // Load More functionality
    const loadMoreBtn = document.getElementById('loadMoreBtn');
    if (loadMoreBtn) {
        loadMoreBtn.addEventListener('click', async function() {
            const currentOffset = parseInt(this.dataset.offset);
            const loadingSpinner = document.getElementById('loadingSpinner');

            // Show loading state
            this.style.display = 'none';
            loadingSpinner.classList.remove('d-none');

            // Build URL with current filters and offset
            const url = new URL(window.location.href);
            url.searchParams.set('offset', currentOffset);

            try {
                const response = await fetch(url.toString(), {
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                });

                const data = await response.json();

                if (data.html) {
                    // Append new experiences to grid
                    const grid = document.getElementById('experiencesGrid');
                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = data.html;

                    // Append each card
                    Array.from(tempDiv.children).forEach(child => {
                        grid.appendChild(child);
                    });

                    // Animate new cards
                    setTimeout(() => {
                        animateCards();
                    }, 100);

                    // Re-attach bookmark event listeners to new cards
                    const newBookmarkButtons = grid.querySelectorAll('.bookmark-btn:not(.listener-attached)');
                    newBookmarkButtons.forEach(button => {
                        button.classList.add('listener-attached');
                        button.addEventListener('click', async function(e) {
                            e.preventDefault();

                            {% if not user.is_authenticated %}
                            window.location.href = '{% url "login" %}';
                            return;
                            {% endif %}

                            const experienceId = this.dataset.experienceId;
                            const originalContent = this.innerHTML;

                            this.disabled = true;
                            this.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';

                            try {
                                const response = await fetch(`{% url 'experiences:bookmark_experience' '00000000-0000-0000-0000-000000000000' %}`.replace('00000000-0000-0000-0000-000000000000', experienceId), {
                                    method: 'POST',
                                    headers: {
                                        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                                        'Content-Type': 'application/json',
                                    },
                                });

                                const data = await response.json();

                                if (data.success) {
                                    if (data.bookmarked) {
                                        this.innerHTML = '<i class="fas fa-bookmark"></i>';
                                        this.classList.add('bookmarked');
                                        showBookmarkMessage('Added to bookmarks!', 'success');
                                    } else {
                                        this.innerHTML = '<i class="far fa-bookmark"></i>';
                                        this.classList.remove('bookmarked');
                                        showBookmarkMessage('Removed from bookmarks', 'info');
                                    }
                                } else {
                                    showBookmarkMessage('Failed to bookmark', 'error');
                                    this.innerHTML = originalContent;
                                }
                            } catch (error) {
                                showBookmarkMessage('Network error', 'error');
                                this.innerHTML = originalContent;
                            }

                            this.disabled = false;
                        });
                    });

                    // Update button state
                    if (data.has_more) {
                        this.dataset.offset = data.next_offset;
                        this.style.display = 'inline-block';
                        loadingSpinner.classList.add('d-none');
                    } else {
                        // No more experiences - hide button
                        this.remove();
                        loadingSpinner.remove();

                        // Show "all loaded" message
                        const allLoadedMsg = document.createElement('p');
                        allLoadedMsg.className = 'text-muted text-center';
                        allLoadedMsg.innerHTML = '<i class="fas fa-check-circle me-2"></i>All experiences loaded!';
                        document.querySelector('.container').appendChild(allLoadedMsg);
                    }
                }
            } catch (error) {
                console.error('Error loading more experiences:', error);
                loadingSpinner.classList.add('d-none');
                this.style.display = 'inline-block';

                // Show error message
                showBookmarkMessage('Failed to load more experiences', 'error');
            }
        });
    }
});
</script>

{% csrf_token %}
{% endblock %}