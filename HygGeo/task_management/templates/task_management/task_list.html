{% extends 'base.html' %}
{% load static %}

{% block title %}All Tasks - Task Management{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'task_management/css/task_management.css' %}">
{% endblock %}

{% block content %}
<div class="container-fluid" style="max-width: 1400px; padding: var(--spacing-xl) 24px;">
    <!-- Hero -->
    <div class="modern-hero">
        <div class="hero-content">
            <h1 class="hero-title">
                <i class="fas fa-list"></i> All Tasks
            </h1>
            <p class="hero-subtitle">
                Manage and track all your tasks in one place
            </p>
            <div class="hero-actions">
                <a href="{% url 'task_management:task_create' %}" class="btn-hero">
                    <i class="fas fa-plus"></i>
                    New Task
                </a>
                <a href="{% url 'task_management:dashboard' %}" class="btn-hero btn-hero-outline">
                    <i class="fas fa-arrow-left"></i>
                    Back to Dashboard
                </a>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <div class="nav-modern">
        <a href="{% url 'task_management:dashboard' %}" class="nav-link">
            <i class="fas fa-home"></i> Dashboard
        </a>
        <a href="{% url 'task_management:task_list' %}" class="nav-link active">
            <i class="fas fa-list"></i> All Tasks
        </a>
        <a href="{% url 'task_management:kanban' %}" class="nav-link">
            <i class="fas fa-columns"></i> Kanban
        </a>
        <a href="{% url 'task_management:calendar' %}" class="nav-link">
            <i class="fas fa-calendar"></i> Calendar
        </a>
        <a href="{% url 'task_management:project_list' %}" class="nav-link">
            <i class="fas fa-folder"></i> Projects
        </a>
    </div>

    <!-- Filters -->
    <div class="filter-card">
        <h3 class="filter-title">
            <i class="fas fa-filter"></i>
            Filter Tasks
        </h3>
        <form method="get" class="row g-3">
            <div class="col-md-3">
                <label class="form-label">Status</label>
                <select name="status" class="form-select" onchange="this.form.submit()">
                    <option value="">All Statuses</option>
                    <option value="todo" {% if request.GET.status == 'todo' %}selected{% endif %}>To Do</option>
                    <option value="in_progress" {% if request.GET.status == 'in_progress' %}selected{% endif %}>In Progress</option>
                    <option value="in_review" {% if request.GET.status == 'in_review' %}selected{% endif %}>In Review</option>
                    <option value="completed" {% if request.GET.status == 'completed' %}selected{% endif %}>Completed</option>
                    <option value="blocked" {% if request.GET.status == 'blocked' %}selected{% endif %}>Blocked</option>
                </select>
            </div>
            <div class="col-md-3">
                <label class="form-label">Priority</label>
                <select name="priority" class="form-select" onchange="this.form.submit()">
                    <option value="">All Priorities</option>
                    <option value="low" {% if request.GET.priority == 'low' %}selected{% endif %}>Low</option>
                    <option value="medium" {% if request.GET.priority == 'medium' %}selected{% endif %}>Medium</option>
                    <option value="high" {% if request.GET.priority == 'high' %}selected{% endif %}>High</option>
                    <option value="urgent" {% if request.GET.priority == 'urgent' %}selected{% endif %}>Urgent</option>
                </select>
            </div>
            <div class="col-md-3">
                <label class="form-label">Project</label>
                <select name="project" class="form-select" onchange="this.form.submit()">
                    <option value="">All Projects</option>
                    {% for project in projects %}
                    <option value="{{ project.id }}" {% if request.GET.project == project.id|stringformat:"s" %}selected{% endif %}>
                        {{ project.name }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-3">
                <label class="form-label">Sort By</label>
                <select name="sort" class="form-select" onchange="this.form.submit()">
                    <option value="-created_at" {% if request.GET.sort == '-created_at' or not request.GET.sort %}selected{% endif %}>Newest First</option>
                    <option value="created_at" {% if request.GET.sort == 'created_at' %}selected{% endif %}>Oldest First</option>
                    <option value="due_date" {% if request.GET.sort == 'due_date' %}selected{% endif %}>Due Date</option>
                    <option value="priority" {% if request.GET.sort == 'priority' %}selected{% endif %}>Priority</option>
                    <option value="title" {% if request.GET.sort == 'title' %}selected{% endif %}>Title A-Z</option>
                </select>
            </div>
        </form>
    </div>

    <!-- Task List -->
    <div class="content-card-modern">
        <div class="card-header-modern">
            <h3 class="card-title-modern">
                <i class="fas fa-tasks"></i>
                Tasks ({{ tasks.count }})
            </h3>
            {% if request.GET %}
            <a href="{% url 'task_management:task_list' %}" class="btn-hero" style="padding: 10px 20px; font-size: 13px;">
                <i class="fas fa-times"></i>
                Clear Filters
            </a>
            {% endif %}
        </div>

        {% if tasks %}
            {% for task in tasks %}
            <div class="task-item-modern" onclick="window.location.href='{% url 'task_management:task_detail' task.pk %}'">
                <input type="checkbox" class="task-checkbox" {% if task.status == 'completed' %}checked{% endif %} onclick="event.stopPropagation();">
                <div class="task-content-modern">
                    <div class="task-title-modern">
                        {{ task.title }}
                        {% if task.is_overdue and task.status != 'completed' %}
                        <span class="badge-modern badge-priority-urgent">Overdue</span>
                        {% endif %}
                    </div>
                    <div class="task-meta-modern">
                        <span><i class="fas fa-folder"></i> {% if task.project %}{{ task.project.name }}{% else %}No Project{% endif %}</span>
                        {% if task.due_date %}
                        <span {% if task.is_overdue and task.status != 'completed' %}style="color: #ef4444; font-weight: 700;"{% endif %}>
                            <i class="fas fa-calendar"></i> {{ task.due_date|date:"M d, Y" }}
                        </span>
                        {% endif %}
                        <span><i class="fas fa-user"></i> {{ task.created_by.username }}</span>
                    </div>
                </div>
                <div class="task-badges-modern">
                    <span class="badge-modern badge-status-{{ task.status }}">{{ task.get_status_display }}</span>
                    <span class="badge-modern badge-priority-{{ task.priority }}">{{ task.get_priority_display }}</span>
                </div>
            </div>
            {% endfor %}
        {% else %}
        <div class="empty-state-modern">
            <div class="empty-icon">
                <i class="fas fa-inbox"></i>
            </div>
            <div class="empty-title">No tasks found</div>
            <div class="empty-text">
                {% if request.GET %}
                Try adjusting your filters or <a href="{% url 'task_management:task_list' %}">clear all filters</a>
                {% else %}
                Create your first task to get started
                {% endif %}
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
