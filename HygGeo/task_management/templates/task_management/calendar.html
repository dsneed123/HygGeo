{% extends 'base.html' %}
{% load static %}

{% block title %}Calendar - Task Management{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'task_management/css/task_management.css' %}">
<link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css' rel='stylesheet' />
<style>
/* Calendar Customization */
.fc {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
}

.fc-toolbar-title {
    font-size: 1.75rem !important;
    font-weight: 700 !important;
    color: var(--hygge-green) !important;
}

.fc-button {
    background: var(--hygge-green) !important;
    border: none !important;
    padding: 10px 20px !important;
    border-radius: 10px !important;
    font-weight: 600 !important;
    transition: all 0.3s ease !important;
}

.fc-button:hover {
    background: var(--hygge-light-green) !important;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(45, 90, 61, 0.3) !important;
}

.fc-button-active {
    background: var(--hygge-dark-green) !important;
}

.fc-daygrid-day:hover {
    background-color: rgba(45, 90, 61, 0.05);
}

.fc-event {
    border-radius: 6px !important;
    padding: 4px 8px !important;
    font-weight: 500 !important;
    cursor: pointer !important;
    transition: all 0.2s ease !important;
    border: none !important;
}

.fc-event:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.2) !important;
}
</style>
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js'></script>
{% endblock %}

{% block content %}
<div class="container-fluid" style="max-width: 1400px; padding: var(--spacing-xl) 24px;">
    <!-- Hero -->
    <div class="modern-hero">
        <div class="hero-content">
            <h1 class="hero-title">
                <i class="fas fa-calendar"></i> Task Calendar
            </h1>
            <p class="hero-subtitle">
                View your tasks and deadlines in calendar format
            </p>
            <div class="hero-actions">
                <a href="{% url 'task_management:task_create' %}" class="btn-hero">
                    <i class="fas fa-plus"></i>
                    New Task
                </a>
                <a href="{% url 'task_management:dashboard' %}" class="btn-hero btn-hero-outline">
                    <i class="fas fa-arrow-left"></i>
                    Back to Dashboard
                </a>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <div class="nav-modern">
        <a href="{% url 'task_management:dashboard' %}" class="nav-link">
            <i class="fas fa-home"></i> Dashboard
        </a>
        <a href="{% url 'task_management:task_list' %}" class="nav-link">
            <i class="fas fa-list"></i> All Tasks
        </a>
        <a href="{% url 'task_management:kanban' %}" class="nav-link">
            <i class="fas fa-columns"></i> Kanban
        </a>
        <a href="{% url 'task_management:calendar' %}" class="nav-link active">
            <i class="fas fa-calendar"></i> Calendar
        </a>
        <a href="{% url 'task_management:project_list' %}" class="nav-link">
            <i class="fas fa-folder"></i> Projects
        </a>
    </div>

    <!-- Legend -->
    <div class="filter-card">
        <h3 class="filter-title">
            <i class="fas fa-palette"></i>
            Legend
        </h3>
        <div class="d-flex flex-wrap gap-3">
            <div class="d-flex align-items-center gap-2">
                <div style="width: 20px; height: 20px; background: #94a3b8; border-radius: 4px;"></div>
                <span>Low Priority</span>
            </div>
            <div class="d-flex align-items-center gap-2">
                <div style="width: 20px; height: 20px; background: #3b82f6; border-radius: 4px;"></div>
                <span>Medium Priority</span>
            </div>
            <div class="d-flex align-items-center gap-2">
                <div style="width: 20px; height: 20px; background: #f59e0b; border-radius: 4px;"></div>
                <span>High Priority</span>
            </div>
            <div class="d-flex align-items-center gap-2">
                <div style="width: 20px; height: 20px; background: #ef4444; border-radius: 4px;"></div>
                <span>Urgent Priority</span>
            </div>
        </div>
    </div>

    <!-- Calendar -->
    <div class="content-card-modern">
        <div id="calendar"></div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    var calendarEl = document.getElementById('calendar');

    // Prepare events data
    var events = [
        {% for task in tasks %}
        {
            title: '{{ task.title|escapejs }}',
            start: '{% if task.start_date %}{{ task.start_date|date:"Y-m-d" }}{% else %}{{ task.created_at|date:"Y-m-d" }}{% endif %}',
            {% if task.due_date %}
            end: '{{ task.due_date|date:"Y-m-d" }}',
            {% endif %}
            url: '{% url "task_management:task_detail" task.pk %}',
            backgroundColor: '{% if task.priority == "urgent" %}#ef4444{% elif task.priority == "high" %}#f59e0b{% elif task.priority == "medium" %}#3b82f6{% else %}#94a3b8{% endif %}',
            borderColor: '{% if task.priority == "urgent" %}#dc2626{% elif task.priority == "high" %}#d97706{% elif task.priority == "medium" %}#2563eb{% else %}#64748b{% endif %}',
            textColor: 'white'
        },
        {% endfor %}
    ];

    var calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        headerToolbar: {
            left: 'prev,next today',
            center: 'title',
            right: 'dayGridMonth,timeGridWeek,listWeek'
        },
        events: events,
        eventClick: function(info) {
            info.jsEvent.preventDefault();
            if (info.event.url) {
                window.location.href = info.event.url;
            }
        },
        height: 'auto',
        contentHeight: 'auto',
        aspectRatio: 1.8
    });

    calendar.render();
});
</script>
{% endblock %}
