{% extends "base.html" %}
{% load cloudflare_images %}

{% block title %}{{ profile_user.username }} - HygGeo Profile{% endblock %}

{% block content %}
<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-md-8">

      <!-- Profile Card -->
      <div class="card card-hygge shadow-sm p-4 text-center">

        <!-- Avatar -->
        {% if profile_user.userprofile.avatar %}
          <img src="{{ profile_user.userprofile.avatar.url|cf_image:'format=webp,width=200,quality=30,fit=cover' }}"
               alt="{{ profile_user.username }}"
               class="rounded-circle img-fluid mb-3"
               style="width:140px; height:140px; object-fit:cover; border: 4px solid var(--hygge-green);">
        {% else %}
          <div class="rounded-circle bg-secondary d-flex align-items-center justify-content-center mx-auto mb-3"
               style="width:140px; height:140px;">
            <i class="fas fa-user text-white" style="font-size:3.5rem;"></i>
          </div>
        {% endif %}

        <!-- Name -->
        <h2 class="fw-bold" style="color: var(--hygge-green);">
          {{ profile_user.first_name }} {{ profile_user.last_name|default:profile_user.username }}
        </h2>

        <!-- Location -->
        {% if profile_user.userprofile.location %}
          <p class="text-muted mb-2">
            <i class="fas fa-map-marker-alt me-1"></i>
            {{ profile_user.userprofile.location }}
          </p>
        {% endif %}

        <!-- Bio -->
        {% if profile_user.userprofile.bio %}
          <p class="text-muted fst-italic">{{ profile_user.userprofile.bio }}</p>
        {% endif %}

        <hr class="my-4">

        <!-- Action Buttons -->
        <div class="d-flex gap-2 justify-content-center">
          <a href="{% url 'send_message' profile_user.username %}"
             class="btn btn-outline-hygge btn-sm px-4">
            <i class="fas fa-envelope me-1"></i> Message
          </a>
          <button class="btn btn-hygge btn-sm px-4"
                  onclick="connectWithUser('{{ profile_user.username }}')">
            <i class="fas fa-user-plus me-1"></i> Connect
          </button>
        </div>

      </div>

      <!-- Public Trips -->
      {% if public_trips.exists %}
        <div class="card mt-4 p-3 shadow-sm">
          <h5 class="fw-bold mb-3">Upcoming/Public Trips</h5>
          {% for trip in public_trips %}
            <div class="mb-2 border-bottom pb-2">
              <a href="{{ trip.get_absolute_url }}" class="fw-bold text-decoration-none">
                {{ trip.trip_name }} - {{ trip.destination }}
              </a>
              <div class="small text-muted">
                {{ trip.start_date|date:"M d, Y" }} to {{ trip.end_date|date:"M d, Y" }}
              </div>
            </div>
          {% endfor %}
        </div>
      {% endif %}

      <!-- Past Trips -->
      {% if past_trips.exists %}
        <div class="card mt-4 p-3 shadow-sm">
          <h5 class="fw-bold mb-3">Past Trips</h5>
          {% for trip in past_trips %}
            <div class="mb-2 border-bottom pb-2">
              <a href="{{ trip.get_absolute_url }}" class="fw-bold text-decoration-none">
                {{ trip.trip_name }} - {{ trip.destination }}
              </a>
              <div class="small text-muted">
                {{ trip.start_date|date:"M d, Y" }} to {{ trip.end_date|date:"M d, Y" }}
              </div>
            </div>
          {% endfor %}
        </div>
      {% endif %}

    </div>
  </div>
</div>

<script>
function connectWithUser(username) {
    // Placeholder function - you can hook this up to your connect API
    alert('Request to connect sent to ' + username);
}
</script>
{% endblock %}
